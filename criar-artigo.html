<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Criar Artigo - Geekp√©dia</title>
    <link rel="stylesheet" href="css/style.css" />
    <style>
      body {
        font-family: "JetBrains Mono", monospace;
        background: #0d0d0d;
        color: #00fff2;
        padding: 2rem;
      }

      h1 {
        text-align: center;
        font-family: "Orbitron", sans-serif;
      }

      form {
        max-width: 700px;
        margin: 2rem auto;
        display: flex;
        flex-direction: column;
        gap: 1rem;
        background: rgba(0, 255, 242, 0.05);
        padding: 2rem;
        border: 1px solid #00fff2;
        border-radius: 8px;
      }

      input,
      textarea,
      select,
      button {
        font-family: inherit;
        padding: 0.8rem;
        border: none;
        border-radius: 5px;
        font-size: 1rem;
      }

      input,
      textarea,
      select {
        background: #111;
        color: #00fff2;
        border: 1px solid #00fff2;
      }

      button {
        background-color: #00fff2;
        color: #000;
        font-weight: bold;
        cursor: pointer;
        transition: background-color 0.3s;
      }

      button:hover {
        background-color: #00bfb2;
      }

      .message {
        text-align: center;
        margin-top: 1rem;
        font-weight: bold;
      }

      a.voltar {
        color: #00fff2;
        text-decoration: none;
        display: block;
        text-align: center;
        margin-top: 2rem;
      }
    </style>
  </head>
  <body>
    <h1>üìù Criar Novo Artigo</h1>

    <form id="formArtigo">
      <input type="text" id="titulo" placeholder="T√≠tulo do artigo" required />
      <textarea
        id="descricao"
        placeholder="Descri√ß√£o/resumo"
        rows="3"
        required
      ></textarea>
      <textarea
        id="conteudo"
        placeholder="Conte√∫do completo"
        rows="8"
        required
      ></textarea>

      <select id="categoria" required>
        <option value="">Selecione uma categoria</option>
        <option value="games">üéÆ Games</option>
        <option value="filmes">üé• Filmes & S√©ries</option>
        <option value="tecnologia">üí° Tecnologia</option>
      </select>

      <button type="submit">Publicar Artigo</button>
      <div class="message" id="mensagem"></div>
    </form>

    <a class="voltar" href="home.html">üîô Voltar √† P√°gina Inicial</a>

    <!-- Supabase JS CDN -->
    <script type="module">
      import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

      const supabase = createClient(
        "https://odxqvkwxhbfgcmngdhic.supabase.co",
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9keHF2a3d4aGJmZ2NtbmdkaGljIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMyNjk1MTMsImV4cCI6MjA2ODg0NTUxM30.U47P-s4GNGgk5f_3cQsBxDVLOqp3-jXsOX14Ok8fZk8"
      );

      const form = document.getElementById("formArtigo");
      const mensagem = document.getElementById("mensagem");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const titulo = document.getElementById("titulo").value.trim();
        const descricao = document.getElementById("descricao").value.trim();
        const conteudo = document.getElementById("conteudo").value.trim();
        const categoria = document.getElementById("categoria").value;
        const apelido = localStorage.getItem("apelido");

        if (!apelido) {
          mensagem.textContent =
            "Erro: usu√°rio n√£o identificado. Fa√ßa login novamente.";
          mensagem.style.color = "red";
          return;
        }

        const { data, error } = await supabase
          .from("artigos")
          .insert([{ titulo, descricao, conteudo, categoria, apelido }]);

        if (error) {
          mensagem.textContent = "Erro ao publicar o artigo: " + error.message;
          mensagem.style.color = "red";
        } else {
          mensagem.textContent = "‚úÖ Artigo publicado com sucesso!";
          mensagem.style.color = "#00ff88";
          form.reset();

          setTimeout(() => {
            window.location.href = "home.html";
          }, 1000);
        }
      });
    </script>
  </body>
</html>
